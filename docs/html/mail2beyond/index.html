<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>mail2beyond API documentation</title>
<meta name="description" content="Getting Started
The following sections provides a basic introduction to using Mail2Beyond as a Python package. You can also use
Mail2Beyond entirely â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>mail2beyond</code></h1>
</header>
<section id="section-intro">
<h2 id="getting-started">Getting Started</h2>
<p>The following sections provides a basic introduction to using Mail2Beyond as a Python package. You can also use
Mail2Beyond entirely from the CLI as a standalone server:</p>
<p><a href="#command-line-interface-cli">CLI Documentation</a></p>
<h3 id="defining-connector-objects">Defining Connector Objects</h3>
<p>Connectors are the component that redirects SMTP messages to a specific API or service. There are a handful of built-in
connectors that you can use out of the box, or you can
<a href="#writing-custom-connectors">write your own custom connector modules</a>. Below is an example of defining connector objects
that redirect SMTP messages to Slack and Google Chat:</p>
<pre><code class="language-python">import mail2beyond

# Use bulit-in connector modules to create connector objects
void_connector = mail2beyond.connectors.void.Connector()
google_chat_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR GOOGLE CHAT WEBHOOK URL&gt;&quot;
)
slack_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR SLACK WEBHOOK URL&gt;&quot;
)
</code></pre>
<h3 id="defining-parser-classes">Defining Parser Classes</h3>
<p>Parsers allow you to control how the SMTP message's content body is represented before being redirected using a
connector. If you've used the Mail2Beyond CLI, you are likely aware that the CLI's default parser is the auto parser
that can dynamically choose the best parser based on the SMTP message's content-type header. The Python package requires
the parser class to be specified explicitly, otherwise the BaseParser class is assumed which may have undesired results
as it will leave the content body untouched. Parsers are often used to convert content which is not easily understood
by a human (e.g. HTML content) to a more human-readable format such as markdown. You can reference built-in parser
classes or you can <a href="#writing-custom-parsers">write your own custom parser classes</a>. Parser classes must be defined
before mappings are defined. Below is an example of defining various parser classes that can be used in your mappings:</p>
<pre><code class="language-python">import mail2beyond

# Use bulit-in connector modules to create connector objects
void_connector = mail2beyond.connectors.void.Connector()
google_chat_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR GOOGLE CHAT WEBHOOK URL&gt;&quot;
)
slack_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR SLACK WEBHOOK URL&gt;&quot;
)

# Reference parser classes to use
auto_parser = mail2beyond.parsers.auto.Parser
html_parser = mail2beyond.parsers.html.Parser
plain_parser = mail2beyond.parsers.plain.Parser
</code></pre>
<h4 id="notes">Notes</h4>
<ul>
<li>Some connector modules will not respect the parser (e.g. <code>void</code>, <code>smtp</code>).</li>
<li>Even when a parser converts the content to a markdown format (e.g. <code>html</code>), it does not guarentee the markdown can be
rendered by the service the connector interacts with</li>
</ul>
<h3 id="defining-mapping-objects">Defining Mapping Objects</h3>
<p>Mappings allow you to apply logic to which connectors are used based on the SMTP headers of incoming SMTP messages. A
specified header is checked for a specific pattern using regular expressions. If a match is found, the connector
specified in the mapping will be used to redirect the message. Mappings are checked in descending order and are used on
a first-match basis. At least one mapping must be defined, and at least one mapping must use the pattern <code>default</code> to
assume a default if no other mappings were matched. Connectors must be defined before defining mappings, and mappings
must be defined before defining listeners. Below is an example of defining various mappings:</p>
<pre><code class="language-python">import mail2beyond

# Use bulit-in connector modules to create connector objects
void_connector = mail2beyond.connectors.void.Connector()
google_chat_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR GOOGLE CHAT WEBHOOK URL&gt;&quot;
)
slack_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR SLACK WEBHOOK URL&gt;&quot;
)

# Reference built-in parser classes to use
auto_parser = mail2beyond.parsers.auto.Parser
html_parser = mail2beyond.parsers.html.Parser
plain_parser = mail2beyond.parsers.plain.Parser

# Define mapping to redirect mail sent to 'google_chat@example.com' to Google Chat
google_chat_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;^google_chat@example.com$&quot;, 
    field=&quot;to&quot;,
    connector=google_chat_connector,
    parser=auto_parser
)

# Define mapping that redirects mail from 'slack@example.com' to Slack
slack_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;^slack@example.com$&quot;, 
    field=&quot;from&quot;,
    connector=google_chat_connector,
    parser=plain_parser
)

# Define default mapping to discard mail if it did not match another mapping
default_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;default&quot;, 
    connector=void_connector
)
</code></pre>
<h3 id="defining-listener-objects">Defining Listener Objects</h3>
<p>Listeners are individual instances of the Mail2Beyond SMTP server. Listeners define what address, port and protocol the
server will listen on. Commonly, users will configure a listener for SMTP and another for SMTPS. Additionally,
listeners can be configured to advertise or require the STARTTLS option to upgrade unencrypted connections to encrypted
connections. SMTPS and STARTTLS are configured by creating an <code>SSLContext</code> object via Python's <code>ssl</code> package. Below is
an example of defining various listeners:</p>
<pre><code class="language-python">import mail2beyond
import ssl
import logging

# Use bulit-in connector modules to create connector objects
void_connector = mail2beyond.connectors.void.Connector()
google_chat_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR GOOGLE CHAT WEBHOOK URL&gt;&quot;
)
slack_connector = mail2beyond.connectors.google_chat.Connector(
    webhook_url=&quot;&lt;YOUR SLACK WEBHOOK URL&gt;&quot;
)

# Reference built-in parser classes to use
auto_parser = mail2beyond.parsers.auto.Parser
html_parser = mail2beyond.parsers.html.Parser
plain_parser = mail2beyond.parsers.plain.Parser

# Define mapping to redirect mail sent to 'google_chat@example.com' to Google Chat
google_chat_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;^google_chat@example.com$&quot;, 
    field=&quot;to&quot;,
    connector=google_chat_connector,
    parser=auto_parser
)

# Define mapping that redirects mail from 'slack@example.com' to Slack
slack_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;^slack@example.com$&quot;, 
    field=&quot;from&quot;,
    connector=google_chat_connector,
    parser=plain_parser
)

# Define default mapping to discard mail if it did not match another mapping
default_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;default&quot;, 
    connector=void_connector
)  

# Define a normal SMTP listener
smtp_listener = mail2beyond.framework.Listener(
    mappings=[google_chat_mapping, slack_mapping, default_mapping],
    address=&quot;localhost&quot;,
    port=25,
    log_level=logging.DEBUG
)

# Define an SSLContext for an SMTPS listener
context = ssl.SSLContext(ssl.PROTOCOL_TLS)
context.set_ciphers(&quot;HIGH&quot;)
context.minimum_version = ssl.TLSVersion.TLSv1_2
context.load_cert_chain(
    # Change to your actual cert and key
    &quot;/path/to/my/certificate.pem&quot;, &quot;/path/to/my/private_key.pem&quot;
)  

# Define an SMTPS listener
smtps_listener = mail2beyond.framework.Listener(
    mappings=[google_chat_mapping, slack_mapping, default_mapping],
    address=&quot;localhost&quot;,
    port=465,
    tls_context=context,
    log_level=logging.DEBUG
)

# Start each listener and await incoming SMTP messages
smtp_listener.start()
smtps_listener.start()
mail2beyond.framework.Listener.wait()
</code></pre>
<p>From here, you can simply run your script and Mail2Beyond will be listening for SMTP requests! To verify your setup is
working, you can run the following code in another Python script while the <code><a title="mail2beyond.framework.Listener" href="framework.html#mail2beyond.framework.Listener">Listener</a></code> is still
listening:</p>
<pre><code class="language-python">import smtplib

smtp = smtplib.SMTP(&quot;localhost&quot;, 25, timeout=10)
smtp.sendmail(
    &quot;slack@example.com&quot;,
    &quot;somerecipient@example.com&quot;,
    &quot;FROM: slack@example.com\n&quot;
    &quot;TO: somerecipient@example.com\n&quot;
    &quot;Subject: Test subject\n\n&quot;
    &quot;Test body&quot;
)

# Close the SMTP connection.
smtp.close()
</code></pre>
<p>Assuming your Slack webhook URL was configured correctly, this SMTP message should have matched the <code>slack_mapping</code> and
redirected the SMTP message to your Slack channel!</p>
<hr>
<h2 id="writing-custom-connectors">Writing Custom Connectors</h2>
<p>The Mail2Beyond framework makes it easy to write your own API connectors to allow you to connect to your own APIs, or
virtually do anything you'd like with the received SMTP messages!</p>
<h3 id="creating-the-connector-class">Creating the Connector Class</h3>
<p>The Mail2Beyond framework includes the <code><a title="mail2beyond.framework.BaseConnector" href="framework.html#mail2beyond.framework.BaseConnector">BaseConnector</a></code> class that includes all the necessary
functions to make your custom connector plug and play. To get started, simply create a <code>Connector</code> class that extends
the <code><a title="mail2beyond.framework.BaseConnector" href="framework.html#mail2beyond.framework.BaseConnector">BaseConnector</a></code> class and assign it a default name:</p>
<pre><code class="language-python">import mail2beyond

class Connector(mail2beyond.framework.BaseConnector):
    name = &quot;my_custom_connnector&quot;
</code></pre>
<h3 id="overwrite-the-baseconnectorpre_submit-method">Overwrite the <code><a title="mail2beyond.framework.BaseConnector.pre_submit" href="framework.html#mail2beyond.framework.BaseConnector.pre_submit">BaseConnector.pre_submit()</a></code> Method:</h3>
<p>The <code><a title="mail2beyond.framework.BaseConnector.pre_submit" href="framework.html#mail2beyond.framework.BaseConnector.pre_submit">BaseConnector.pre_submit()</a></code> method is used to validate the Connector object before any
upstream connection is made. Normally, this method is used to validate the connector object's configuration before
running the connector. When the object is first created, any keyword arguments (kwargs) passed into the object creation
will be available in the object's <code>config</code> attribute. You can overwrite the
<code><a title="mail2beyond.framework.BaseConnector.pre_submit" href="framework.html#mail2beyond.framework.BaseConnector.pre_submit">BaseConnector.pre_submit()</a></code> method to ensure required configuration values are present and
valid. Additionally, the <code>parser</code> object is passed to this method and contains the mail headers and content of the SMTP
messsage that triggered the connector and the <code>log</code> attribute contains the logger
you can use to log events that occur within the connector:</p>
<pre><code class="language-python">import mail2beyond

class Connector(mail2beyond.framework.BaseConnector):
    name = &quot;my_custom_connnector&quot;

    def pre_submit(self, parser):
        self.log.info(&quot;starting 'my_custom_connector's pre_submit()!&quot;)

        # Check that the required 'url' attribute is present
        if &quot;url&quot; not in self.config:
            self.log.error(&quot;'url' is required!&quot;)
            raise mail2beyond.framework.Error(&quot;'url' is required!&quot;)
</code></pre>
<h3 id="overwrite-the-baseconnectors-submit-method">Overwrite the BaseConnector's <code>submit()</code> Method:</h3>
<p>The <code><a title="mail2beyond.framework.BaseConnector.submit" href="framework.html#mail2beyond.framework.BaseConnector.submit">BaseConnector.submit()</a></code> method is used to perform the main action for this connector. In
most cases, this will be an API request to an upstream service. A <code>parser</code> object is passed to this method that contents
the mail headers and content that triggered this connector and the <code>log</code> attribute contains the logger you can use to
log events that occur within the Connector. Additionally, the <code>config</code> attribute will contain any configuration
required to perform the desired action. Ideally, this <code>config</code> attribute will have been fully validated by the
<code><a title="mail2beyond.framework.BaseConnector.pre_submit" href="framework.html#mail2beyond.framework.BaseConnector.pre_submit">BaseConnector.pre_submit()</a></code> method.</p>
<pre><code class="language-python">import mail2beyond
import requests

class Connector(mail2beyond.framework.BaseConnector):
    name = &quot;my_custom_connnector&quot;

    def pre_submit(self, parser):
        self.log.info(&quot;starting 'my_custom_connector's pre_submit()!&quot;)

        # Check that the required 'url' attribute is present
        if &quot;url&quot; not in self.config:
            self.log.error(&quot;'url' is required!&quot;)
            raise mail2beyond.framework.Error(&quot;'url' is required!&quot;)


    def submit(self, parser):
        # Log informational event
        self.log.info(&quot;starting submit()!&quot;)

        # Example variables
        subject = parser.subject
        content = parser.content
        date = parser.mail.headers.get(&quot;date&quot;)
        some_header = parser.mail.headers.get(&quot;some_header&quot;)

        # Make an API request to 'url' value found in the config
        try:
            resp = requests.post(
                url=self.config[&quot;url&quot;],
                headers={'Content-Type': 'application/json'},
                json={
                    &quot;msg&quot;: f&quot;{subject}\n{content}\n{date}\n{some_header}&quot;
                }
            )
            self.log.debug(
                f&quot;connector responded with {resp.status_code} status {resp.text}&quot;
            )
        except Exception as err:
            self.log.error(f&quot;an error occurred!'{err}'&quot;)
            raise mail2beyond.framework.Error(f&quot;an error occurred! '{err}'&quot;)
</code></pre>
<h3 id="utilizing-your-custom-connector">Utilizing Your Custom Connector</h3>
<p>Now that you've created your custom connector class, you can simply create an object using your connector class and use
it in your mappings like any other connector!</p>
<pre><code class="language-python">import mail2beyond
import requests
import logging


class Connector(mail2beyond.framework.BaseConnector):
    name = &quot;my_custom_connnector&quot;

    def pre_submit(self, parser):
        self.log.info(&quot;starting 'my_custom_connector's pre_submit()!&quot;)

        # Check that the required 'url' attribute is present
        if &quot;url&quot; not in self.config:
            self.log.error(&quot;'url' is required!&quot;)
            raise mail2beyond.framework.Error(&quot;'url' is required!&quot;)


    def submit(self, parser):
        # Log informational event
        self.log.info(&quot;starting submit()!&quot;)

        # Example variables
        subject = parser.subject
        content = parser.content
        date = parser.mail.headers.get(&quot;date&quot;)
        some_header = parser.mail.headers.get(&quot;some_header&quot;)

        # Make an API request to 'url' value found in the config
        try:
            resp = requests.post(
                url=self.config[&quot;url&quot;],
                headers={'Content-Type': 'application/json'},
                json={
                    &quot;msg&quot;: f&quot;{subject}\n{content}\n{date}\n{some_header}&quot;
                }
            )
            self.log.debug(
                f&quot;connector responded with {resp.status_code} status {resp.text}&quot;
            )
        except Exception as err:
            self.log.error(f&quot;an error occurred!'{err}'&quot;)
            raise mail2beyond.framework.Error(f&quot;an error occurred! '{err}'&quot;)

# Create a connector object using your custom connector class
custom_connector = Connector(url=&quot;http://myapi.example.com&quot;)

# Create a default mapping that uses your custom connector
default_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;default&quot;, 
    connector=custom_connector
)

# Create and listener that uses the mapping referencing your custom connector
smtp_listener = mail2beyond.framework.Listener(
    mappings=[default_mapping],
    address=&quot;localhost&quot;,
    port=25,
    log_level=logging.DEBUG
)

# Start the listener
smtp_listener.start()
mail2beyond.framework.Listener.wait()
</code></pre>
<p>Now you have a <code>Listener</code> that will redirect SMTP messages to your API using a custom connector!</p>
<h2 id="writing-custom-parsers">Writing Custom Parsers</h2>
<p>In some cases, you may need the SMTP message's content body to be parsed into a very specific format. Luckily the
Mail2Beyond framework makes this super simple to do. Custom parser classes can be written to allow you to parse the
content body however you'd like!</p>
<h3 id="creating-the-parser-class">Creating the Parser Class</h3>
<p>The Mail2Beyond framework includes the BaseParser class that includes all the functions necessary to make your
custom parser plug and play. To get started, simply create a <code>Parser</code> class that extends the
<code><a title="mail2beyond.framework.BaseParser" href="framework.html#mail2beyond.framework.BaseParser">BaseParser</a></code> class and assign it a default name:</p>
<pre><code class="language-python">import mail2beyond

class Parser(mail2beyond.framework.BaseParser):
    name = &quot;my_custom_parser&quot;
</code></pre>
<h3 id="overwrite-the-baseparserparse_content-method">Overwrite the <code><a title="mail2beyond.framework.BaseParser.parse_content" href="framework.html#mail2beyond.framework.BaseParser.parse_content">BaseParser.parse_content()</a></code> Method:</h3>
<p>The <code>parse_content()</code> method is used to perform additional formatting to the SMTP message's content body. The parser's
<code>mail.content</code> attribute contains the content body from the received SMTP message. In the case the content was sent
with an encoding like Base64, the content will <em>already be decoded</em> at this stage. The <code>parse_content()</code> can be
overwritten to further parse/filter the content before it handed to a connector:</p>
<pre><code class="language-python">import mail2beyond

class Parser(mail2beyond.framework.BaseParser):
    name = &quot;my_custom_parser&quot;

    def parse_content(self):
        # Capture the message's content.
        content = self.mail.content

        # Only include content after a specific keyword
        content = content.split(&quot;&lt;SOME KEYWORD&gt;&quot;)[1]

        # Mask sensitive content
        content = content.replace(&quot;&lt;SOME SENSITIVE CONTENT&gt;&quot;, &quot;*****&quot;)

        # Return the parsed content
        return content

</code></pre>
<h3 id="utilizing-your-custom-parser">Utilizing Your Custom Parser</h3>
<p>Now that you've created your custom parser class, you can simply specify your custom Parser class in your mappings
like any other parser class!</p>
<pre><code class="language-python">import mail2beyond
import logging

class Parser(mail2beyond.framework.BaseParser):
    name = &quot;my_custom_parser&quot;

    def parse_content(self):
        # Capture the message's content.
        content = self.mail.content

        # Only include content after a specific keyword
        content = content.split(&quot;&lt;SOME KEYWORD&gt;&quot;)[1]

        # Mask sensitive content
        content = content.replace(&quot;&lt;SOME SENSITIVE CONTENT&gt;&quot;, &quot;*****&quot;)

        # Return the parsed content
        return content

# Create a connector object using your custom connector class
void_connector = mail2beyond.connectors.void.Connector()

# Create a default mapping that uses your custom connector
default_mapping = mail2beyond.framework.Mapping(
    pattern=&quot;default&quot;, 
    connector=void_connector, 
    parser=Parser
)

# Create a listener that uses the mapping referencing your custom parser
smtp_listener = mail2beyond.framework.Listener(
    mappings=[default_mapping],
    address=&quot;localhost&quot;,
    port=25,
    log_level=logging.DEBUG
)

# Start the listener
smtp_listener.start()
mail2beyond.framework.Listener.wait()
</code></pre>
<p>Now you have a <code><a title="mail2beyond.framework.Listener" href="framework.html#mail2beyond.framework.Listener">Listener</a></code> that will parse the mail content using your custom parser before
calling a connector!</p>
<h1 id="command-line-interface-cli">Command Line Interface (CLI)</h1>
<hr>
<p>Mail2Beyond can be used entirely by CLI. After installing Mail2Beyond, you will have access to the <code>mail2beyond</code>
command line tool. The CLI allows you define listeners, connectors and mappings using a JSON or YAML formatted
configuration file.</p>
<h2 id="arguments">Arguments</h2>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align: left;">Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--config (-c) &lt;FILE&gt;</code></td>
<td style="text-align: left;">Yes</td>
<td>Specifies a config file to load. This must be a JSON or YAML file.</td>
</tr>
<tr>
<td><code>--version (-V)</code></td>
<td style="text-align: left;">No</td>
<td>Prints the version of mail2beyond installed.</td>
</tr>
<tr>
<td><code>--verbose (-v)</code></td>
<td style="text-align: left;">No</td>
<td>Enables verbose logging.</td>
</tr>
<tr>
<td><code>--help (-h)</code></td>
<td style="text-align: left;">No</td>
<td>Prints the help page.</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration</h2>
<p>A configuration file must be written before <code>mail2beyond</code> is started. It may also be helpful to check out the
<a href="https://github.com/soluna-studios/mail2beyond/tree/master/examples/configs">examples on GitHub</a>. Configuration
requirements and options are:</p>
<hr>
<h3 id="listeners"><code>listeners</code></h3>
<p>A list of listeners for mail2beyond to use. At least one listener must be configured. Each listener has the following
options available:</p>
<p><strong>address</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The IP address this listener will listen on. This must be an address known to the local system.</li>
</ul>
<p><strong>port</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The TCP port this listen will listen on. This must be a numeric value within 1-65535.</li>
</ul>
<p><strong>enable_smtps</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>true</code>, <code>false</code>]</li>
<li><em>Default</em>: false</li>
<li><em>Description</em>: Enables or disables SMTPS. If set to <code>true</code>, the <code>tls_cert</code> and <code>tls_key</code> options must be set. This
option cannot be set to <code>true</code> if <code>enable_starttls</code> is also set to <code>true</code>.</li>
</ul>
<p><strong>enable_starttls</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>true</code>, <code>false</code>]</li>
<li><em>Default</em>: false</li>
<li><em>Description</em>: Enables or disables advertisement for the SMTP protocol's STARTTLS function. STARTTLS allows an
insecure SMTP connections to upgrade to a secure connection. If set to <code>true</code>, the <code>tls_cert</code> and <code>tls_key</code> options
must be set. This option cannot be set to <code>true</code> if <code>enable_smtps</code> is also set to <code>true</code>.</li>
</ul>
<p><strong>require_starttls</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>true</code>, <code>false</code>]</li>
<li><em>Default</em>: false</li>
<li><em>Description</em>: Enables or disables requirement for SMTP clients to use the STARTTLS function. If set to <code>true</code>, any
SMTP connection received must use the STARTTLS function to be accepted. This option is only available when
<code>enable_starttls</code> is set to <code>true</code>. </li>
</ul>
<p><strong>tls_cert</strong></p>
<ul>
<li><em>Required</em>: Yes w/<code>enable_smtps</code> or <code>enable_starttls</code></li>
<li><em>Description</em>: The file path to the TLS certificate to use for secure connections. Only PEM formatted certificates
are supported. This option is only available when <code>enable_starttls</code> is set to <code>true</code>. </li>
</ul>
<p><strong>tls_key</strong></p>
<ul>
<li><em>Required</em>: Yes w/<code>enable_smtps</code> or <code>enable_starttls</code></li>
<li><em>Description</em>: The file path to the TLS private key to use for secure connections. Only PEM formatted private keys
are supported. This option is only available when <code>enable_starttls</code> is set to <code>true</code>. </li>
</ul>
<p><strong>minimum_tls_protocol</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>tls1</code>, <code>tls1_1</code>, <code>tls1_2</code>, <code>tls1_3</code>]</li>
<li><em>Default</em>: <code>tls1_2</code></li>
<li><em>Description</em>: Explicitly sets the minimum TLS protocol allowed by the server. Deprecated SSLv2 and SSLv3 are not
supported as these protocols contain major security vulnerabilities. This option is only available when
<code>enable_smtps</code> or <code>enable_starttls</code> is set to <code>true</code>. </li>
</ul>
<h3 id="connectors"><code>connectors</code></h3>
<p>A list of connectors for mail2beyond to enable. At least one connector item must be configured. Each connector has the
following options available:</p>
<p><strong>name</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The name to assign this connector. This name must be unique from any other connector defined in your
configuration. This name will be used to assign this connector to mappings in your configuration.</li>
</ul>
<p><strong>module</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Options</em>: [<code>void</code>, <code>smtp</code>, <code>google_chat</code>, <code>slack</code>]</li>
<li><em>Description</em>: The module this connector will use. Multiple connectors can use the same underlying module.</li>
</ul>
<p><strong>config</strong></p>
<ul>
<li><em>Required</em>: Dependent on <code>module</code> selected.</li>
<li><em>Description</em>: Additional module specific configurations. Refer to the
<a href="#connector-specific-configuration">connector-specific configurations section</a> for requirements and options for the
specified module for this connector.</li>
</ul>
<h3 id="mappings"><code>mappings</code></h3>
<p>A list of mapping rules to apply. Mappings allow you to apply logic to which connectors are used based on the SMTP
headers of incoming SMTP messages. A specified header is checked for a specific pattern using regular expressions. If a
match is found, the connector specified in the mapping will be used to redirect the message. Mappings are checked in
descending order and are used on a first-match basis. At least one mapping must be defined, and one mapping
must use the pattern <code>default</code> to assume a default if no other mappings were matched. Each mapping has the following
options available:</p>
<p><strong>pattern</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The regex pattern to use when checking for matches. </li>
</ul>
<p><strong>connector</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The name of the connector use upon match. This must be the name of a connector defined in your
configuration. Multiple mappings can use the same the connector.</li>
</ul>
<p><strong>parser</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>auto</code>, <code>plain</code>, <code>html</code>]</li>
<li><em>Default</em>: <code>auto</code></li>
<li><em>Description</em>: Explicitly set the content-type parser to use. By default, the <code>auto</code> parser will be chosen to
select the parser that best matches the SMTP message's content-type header. The <code>plain</code> parser will not parse the
content body and is the fallback for the <code>auto</code> parser if no parser exists for the content-type. The <code>html</code> parser
will parse the content body as HTML and convert it to a more human-readable markdown format.</li>
<li><em>Notes</em>:</li>
<li>Some connector modules do not respect the <code>parser</code> option (e.g. <code>smtp</code>, <code>void</code>)</li>
<li>Even though the <code>html</code> parser converts the content to markdown, this does not guarantee the markdown content will
be rendered by the upstream server (e.g. <code>google_chat</code>, <code>slack</code>)</li>
</ul>
<p><strong>field</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Default</em>: <code>from</code></li>
<li><em>Description</em>: The SMTP header to check for a match. Most commonly this will be <code>from</code> or <code>to</code> to match
based on the sender or recipient of the SMTP message respectively.</li>
</ul>
<h2 id="connector-specific-configuration">Connector-Specific Configuration</h2>
<p>Connector modules may contain their own configurable options and requirements. Below are the available configuration
options available to each built-in connector module:</p>
<h3 id="void"><code>void</code></h3>
<p>The <code>void</code> connector module simply discards the received SMTP message. This connector module has no available
configuration options. </p>
<h3 id="smtp"><code>smtp</code></h3>
<p>The <code>smtp</code> connector module forwards received SMTP messages to an upstream SMTP server. On its own, Mail2Beyond does not
actually deliver the SMTP message to the recipient's mailbox. This connector module enables that functionality but
requires an upstream SMTP to deliver the message. Available options for this module are:</p>
<p><strong>smtp_host</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The IP address or hostname of the upstream SMTP server to forward messages to.</li>
</ul>
<p><strong>smtp_port</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The TCP port of the upstream SMTP server. This must be a numeric value within 1-65535. In most cases
this is <code>25</code> for SMTP and <code>465</code> for SMTPS.</li>
</ul>
<p><strong>smtp_use_tls</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>true</code>, <code>false</code>]</li>
<li><em>Default</em>: <code>false</code></li>
<li><em>Description</em>: Enable or disable forwarding messages to the upstream SMTP server using SMTPS. If <code>true</code>, the
upstream SMTP server must be configured to allow SMTPS connections.</li>
</ul>
<p><strong>smtp_use_login</strong></p>
<ul>
<li><em>Required</em>: No</li>
<li><em>Options</em>: [<code>true</code>, <code>false</code>]</li>
<li><em>Default</em>: <code>false</code></li>
<li><em>Description</em>: Enable or disable SMTP authentication. If the upstream SMTP server requires authentication, this
option should be set to <code>true</code>. If set to <code>true</code>, the <code>smtp_login_user</code> and <code>smtp_login_password</code> must be set.</li>
</ul>
<p><strong>smtp_login_user</strong></p>
<ul>
<li><em>Required</em>: Yes w/<code>smtp_use_login</code></li>
<li><em>Description</em>: The username to authenticate with.</li>
</ul>
<p><strong>smtp_login_password</strong></p>
<ul>
<li><em>Required</em>: Yes w/<code>smtp_use_login</code></li>
<li><em>Description</em>: The password to authenticate with.</li>
</ul>
<h3 id="slack"><code>slack</code></h3>
<p>The <code>slack</code> module allows SMTP messages to be redirected to a Slack channel using a webhook. A webhook must be
created for your channel beforehand. Available options for this module are:</p>
<p><strong>webhook_url</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The full Slack webhook URL. For help to create a webhook, refer to
<a href="https://api.slack.com/messaging/webhooks">https://api.slack.com/messaging/webhooks</a></li>
</ul>
<h3 id="google_chat"><code>google_chat</code></h3>
<p>The <code>google_chat</code> module allows SMTP messages to be redirected to a Google Chat space using an app webhook. A webhook
must be created for your space beforehand. Available options for this module are:</p>
<p><strong>webhook_url</strong></p>
<ul>
<li><em>Required</em>: Yes</li>
<li><em>Description</em>: The full Slack webhook URL. For help to create a webhook, refer to
<a href="https://developers.google.com/chat/how-tos/webhooks">https://developers.google.com/chat/how-tos/webhooks</a></li>
</ul>
<h2 id="starting-the-server">Starting the Server</h2>
<p>Once you have your configuration file written, you can start the server by running the following command:</p>
<pre><code class="language-commandline">mail2beyond --config /path/to/your/config.yml
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
.. include:: ./docs/documentation.md
&#34;&#34;&#34;
from . import framework
from . import connectors
from . import parsers
from . import tools

# Don&#39;t include tests module in generated documentation.
__pdoc__ = {&#34;tests&#34;: False}</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="mail2beyond.connectors" href="connectors/index.html">mail2beyond.connectors</a></code></dt>
<dd>
<div class="desc"><p>Module that groups built-in connectors for mail2beyond to use.</p></div>
</dd>
<dt><code class="name"><a title="mail2beyond.framework" href="framework.html">mail2beyond.framework</a></code></dt>
<dd>
<div class="desc"><p>Module that contains the core framework for mail2beyond.</p></div>
</dd>
<dt><code class="name"><a title="mail2beyond.parsers" href="parsers/index.html">mail2beyond.parsers</a></code></dt>
<dd>
<div class="desc"><p>Module that groups all built-in parsers for mail2beyond to use.</p></div>
</dd>
<dt><code class="name"><a title="mail2beyond.tools" href="tools.html">mail2beyond.tools</a></code></dt>
<dd>
<div class="desc"><p>Module that includes tool functions that primarily assist the CLI and unit tests, but may be useful to others.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#getting-started">Getting Started</a><ul>
<li><a href="#defining-connector-objects">Defining Connector Objects</a></li>
<li><a href="#defining-parser-classes">Defining Parser Classes</a><ul>
<li><a href="#notes">Notes</a></li>
</ul>
</li>
<li><a href="#defining-mapping-objects">Defining Mapping Objects</a></li>
<li><a href="#defining-listener-objects">Defining Listener Objects</a></li>
</ul>
</li>
<li><a href="#writing-custom-connectors">Writing Custom Connectors</a><ul>
<li><a href="#creating-the-connector-class">Creating the Connector Class</a></li>
<li><a href="#overwrite-the-mail2beyondframeworkbaseconnectorpre_submit-method">Overwrite the mail2beyond.framework.BaseConnector.pre_submit() Method:</a></li>
<li><a href="#overwrite-the-baseconnectors-submit-method">Overwrite the BaseConnector's submit() Method:</a></li>
<li><a href="#utilizing-your-custom-connector">Utilizing Your Custom Connector</a></li>
</ul>
</li>
<li><a href="#writing-custom-parsers">Writing Custom Parsers</a><ul>
<li><a href="#creating-the-parser-class">Creating the Parser Class</a></li>
<li><a href="#overwrite-the-mail2beyondframeworkbaseparserparse_content-method">Overwrite the mail2beyond.framework.BaseParser.parse_content() Method:</a></li>
<li><a href="#utilizing-your-custom-parser">Utilizing Your Custom Parser</a></li>
</ul>
</li>
<li><a href="#command-line-interface-cli">Command Line Interface (CLI)</a><ul>
<li><a href="#arguments">Arguments</a></li>
<li><a href="#configuration">Configuration</a><ul>
<li><a href="#listeners">listeners</a></li>
<li><a href="#connectors">connectors</a></li>
<li><a href="#mappings">mappings</a></li>
</ul>
</li>
<li><a href="#connector-specific-configuration">Connector-Specific Configuration</a><ul>
<li><a href="#void">void</a></li>
<li><a href="#smtp">smtp</a></li>
<li><a href="#slack">slack</a></li>
<li><a href="#google_chat">google_chat</a></li>
</ul>
</li>
<li><a href="#starting-the-server">Starting the Server</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="mail2beyond.connectors" href="connectors/index.html">mail2beyond.connectors</a></code></li>
<li><code><a title="mail2beyond.framework" href="framework.html">mail2beyond.framework</a></code></li>
<li><code><a title="mail2beyond.parsers" href="parsers/index.html">mail2beyond.parsers</a></code></li>
<li><code><a title="mail2beyond.tools" href="tools.html">mail2beyond.tools</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>